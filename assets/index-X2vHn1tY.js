var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{r as s,a as i,b as r}from"./vendor-QTd-ifGo.js";import{u as a,B as n,R as o,a as l}from"./router-CZZb1SVm.js";import{c}from"./supabase-DfFNVlHZ.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var d={exports:{}},u={},h=s,m=Symbol.for("react.element"),p=Symbol.for("react.fragment"),x=Object.prototype.hasOwnProperty,g=h.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,f={key:!0,ref:!0,__self:!0,__source:!0};function y(e,t,s){var i,r={},a=null,n=null;for(i in void 0!==s&&(a=""+s),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(n=t.ref),t)x.call(t,i)&&!f.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===r[i]&&(r[i]=t[i]);return{$$typeof:m,type:e,key:a,ref:n,props:r,_owner:g.current}}u.Fragment=p,u.jsx=y,u.jsxs=y,d.exports=u;var w=d.exports,b={},v=i;b.createRoot=v.createRoot,b.hydrateRoot=v.hydrateRoot;const k={user:null,workouts:[],currentSession:null,statistics:null,isLoading:!1,error:null};function j(e,t){switch(t.type){case"SET_USER":return{...e,user:t.payload};case"SET_WORKOUTS":return{...e,workouts:t.payload};case"START_SESSION":return{...e,currentSession:t.payload};case"UPDATE_SESSION":return{...e,currentSession:e.currentSession?{...e.currentSession,...t.payload}:null};case"END_SESSION":return{...e,currentSession:null};case"SET_STATISTICS":return{...e,statistics:t.payload};case"SET_LOADING":return{...e,isLoading:t.payload};case"SET_ERROR":return{...e,error:t.payload};default:return e}}const N=s.createContext(null);function S({children:e,user:t}){const[i,r]=s.useReducer(j,{...k,user:t}),a=[{id:"upper_a",name:"ðŸ’ª Upper A - Push Dominante",description:"Petto, Spalle, Tricipiti - 40% Compound / 60% Isolation",location:"casa",type:"upper",exercises:[{name:"Spinte Manubri Panca Piana",sets:4,rest_time:120,target_reps:"8-10",equipment:"Manubri + Panca",type:"compound",muscle_group:"petto"},{name:"Overhead Press Rack",sets:4,rest_time:120,target_reps:"6-8",equipment:"Bilanciere + Rack",type:"compound",muscle_group:"spalle"},{name:"Dips Anelli",sets:3,rest_time:120,target_reps:"8-12",equipment:"Anelli",type:"compound",muscle_group:"tricipiti"}]},{id:"lower_a",name:"ðŸ¦µ Lower A - Squat Dominante",description:"Quadricipiti, Glutei, Core - 40% Compound / 60% Isolation",location:"casa",type:"lower",exercises:[{name:"Squat Rack Bilanciere",sets:4,rest_time:180,target_reps:"6-8",equipment:"Bilanciere + Rack",type:"compound",muscle_group:"quadricipiti"},{name:"Front Squat Rack",sets:3,rest_time:150,target_reps:"8-10",equipment:"Bilanciere + Rack",type:"compound",muscle_group:"quadricipiti"}]}],n={loadWorkouts:async()=>{r({type:"SET_LOADING",payload:!0});try{await new Promise(e=>setTimeout(e,1e3)),r({type:"SET_WORKOUTS",payload:a})}catch(e){r({type:"SET_ERROR",payload:"Errore nel caricamento dei workout"})}finally{r({type:"SET_LOADING",payload:!1})}},startWorkout:async e=>{console.log("Starting workout:",e);const s=a.find(t=>t.id===e);if(!s)return void console.error("Workout not found:",e);const i=s.exercises.map(e=>({...e,history:null,suggested_weight:0,current_weight:0})),n={id:Date.now().toString(),workout_id:e,user_id:t.id,start_time:(new Date).toISOString(),status:"active",current_exercise_index:0,current_set:1,exercises_data:i.map(e=>({name:e.name,completed_sets:0,sets_data:[],history:null,suggested_weight:0}))};console.log("Session created:",n),r({type:"START_SESSION",payload:n})},updateSession:e=>{r({type:"UPDATE_SESSION",payload:e})},endSession:async()=>{r({type:"END_SESSION"})},loadStatistics:async()=>{r({type:"SET_LOADING",payload:!0});try{r({type:"SET_STATISTICS",payload:{total_workouts:45,current_streak:7,best_streak:12,total_exercises:234,weekly_goal:4,monthly_goal:16}})}catch(e){r({type:"SET_ERROR",payload:"Errore nel caricamento delle statistiche"})}finally{r({type:"SET_LOADING",payload:!1})}}};return s.useEffect(()=>{n.loadWorkouts(),n.loadStatistics()},[]),w.jsx(N.Provider,{value:{state:i,dispatch:r,actions:n},children:e})}function _(){const e=s.useContext(N);if(!e)throw new Error("useWorkout must be used within a WorkoutProvider");return e}const I=c("https://obdlubqqjgbgjhctphcs.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9iZGx1YnFxamdiZ2poY3RwaGNzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDE2OTUsImV4cCI6MjA4MDA3NzY5NX0.7pWBVjOLYZEg_7deWsTLGrJaBD7eTyhb1U31oFxlWek"),C=s.createContext(void 0);function W({children:e}){const[t,i]=s.useState(null),[r,a]=s.useState(null),[n,o]=s.useState(!0);s.useEffect(()=>{const e=setTimeout(()=>{o(!1)},3e3);I.auth.getSession().then(({data:{session:t}})=>{clearTimeout(e),a(t),i((null==t?void 0:t.user)??null),o(!1)}).catch(()=>{clearTimeout(e),o(!1)});const{data:{subscription:t}}=I.auth.onAuthStateChange(async(e,t)=>{if(a(t),i((null==t?void 0:t.user)??null),o(!1),"SIGNED_IN"===e&&(null==t?void 0:t.user)){const{data:e}=await I.from("profiles").select("id").eq("user_id",t.user.id).single();e||(await I.from("profiles").insert({user_id:t.user.id,name:"Manuel",age:37,height:173,weight:76,goal:"Aumento massa muscolare"}),await I.from("user_preferences").insert({user_id:t.user.id,weekly_plan:"progressive_rotation",reminder_enabled:!0,theme:"dark"}))}});return()=>t.unsubscribe()},[]);return w.jsx(C.Provider,{value:{user:t,session:r,loading:n,signIn:async(e,t)=>{const{error:s}=await I.auth.signInWithPassword({email:e,password:t});return{error:s}},signUp:async(e,t)=>{const{error:s}=await I.auth.signUp({email:e,password:t});return{error:s}},signOut:async()=>{await I.auth.signOut()},signInWithMagicLink:async e=>{const{error:t}=await I.auth.signInWithOtp({email:e,options:{emailRedirectTo:window.location.origin}});return{error:t}}},children:e})}function T(){const e=s.useContext(C);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e}
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var E={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=(e,t)=>{const i=s.forwardRef(({color:i="currentColor",size:r=24,strokeWidth:a=2,absoluteStrokeWidth:n,className:o="",children:l,...c},d)=>{return s.createElement("svg",{ref:d,...E,width:r,height:r,stroke:i,strokeWidth:n?24*Number(a)/Number(r):a,className:["lucide",`lucide-${u=e,u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,o].join(" "),...c},[...t.map(([e,t])=>s.createElement(e,t)),...Array.isArray(l)?l:[l]]);var u});return i.displayName=`${e}`,i},R=L("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),O=L("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),z=L("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),F=L("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),M=L("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),A=L("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]),P=L("Fingerprint",[["path",{d:"M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4",key:"1jc9o5"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12c0-.7.12-1.37.34-2",key:"1mxgy1"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2c0 .47 0 1.17-.02 2",key:"1fgabc"}]]),D=L("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]),q=L("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),$=L("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),U=L("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),J=L("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),B=L("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),V=L("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Z=L("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),G=L("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),Y=L("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),H=L("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),X=L("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),K=L("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),Q=L("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),ee=L("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),te=L("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),se=L("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),ie=L("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),re=L("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),ae="http://localhost:8000",ne="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9iZGx1YnFxamdiZ2poY3RwaGNzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDE2OTUsImV4cCI6MjA4MDA3NzY5NX0.7pWBVjOLYZEg_7deWsTLGrJaBD7eTyhb1U31oFxlWek";const oe=new class{constructor(){t(this,"conversationHistory",[]),t(this,"userId",null)}setUserId(e){this.userId=e}resetConversation(){this.conversationHistory=[]}async chat(e,t){let s=e;(null==t?void 0:t.currentExercise)&&(s=`[Esercizio: ${t.currentExercise}, Set ${t.currentSet}/${t.totalSets}] ${e}`);try{const e=await fetch(`${ae}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s,user_id:this.userId||"anonymous",user_name:"Manuel"})});if(e.ok){const t=await e.json();if(t.success)return{message:t.message,responseId:Date.now().toString(),motivation:this.extractMotivation(t.message)}}return console.log("Backend non disponibile, uso Edge Function"),await this.chatWithEdgeFunction(s,t)}catch(i){return console.error("Backend error, trying Edge Function:",i),await this.chatWithEdgeFunction(s,t)}}async chatWithEdgeFunction(e,t){try{const s=await fetch("https://obdlubqqjgbgjhctphcs.supabase.co/functions/v1/coach-ai",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ne}`,apikey:ne},body:JSON.stringify({message:e,context:t,userId:this.userId})});if(!s.ok)return this.getLocalFallback();const i=s.headers.get("content-type");if(null==i?void 0:i.includes("text/event-stream"))return await this.handleStreamingResponse(s,e);{const e=await s.json();return{message:e.message||"Forza Manuel! Continua cosi!",responseId:e.responseId||"",motivation:this.extractMotivation(e.message)}}}catch(s){return console.error("Edge Function error:",s),this.getLocalFallback()}}async handleStreamingResponse(e,t){var s;const i=null==(s=e.body)?void 0:s.getReader();if(!i)return this.getLocalFallback();const r=new TextDecoder;let a="",n="";const o=[];try{for(;;){const{done:e,value:t}=await i.read();if(e)break;const s=r.decode(t,{stream:!0}).split("\n");for(const i of s)if(i.startsWith("data: "))try{const e=JSON.parse(i.slice(6));"delta"===e.type?a+=e.text:"tool_result"===e.type?(o.push({tool:e.tool,result:e.result}),console.log("Tool result:",e.tool,e.result)):"done"===e.type&&(a=e.message||a,n=e.responseId||"")}catch{}}}finally{i.releaseLock()}return this.conversationHistory.push({role:"user",content:t},{role:"assistant",content:a}),this.conversationHistory.length>20&&(this.conversationHistory=this.conversationHistory.slice(-20)),{message:a||"Forza Manuel! Continua cosi!",responseId:n,motivation:this.extractMotivation(a),toolResults:o.length>0?o:void 0}}async chatWithStreaming(e,t,s){var i;try{const s=await fetch(`${ae}/chat/stream`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,user_id:this.userId||"anonymous",user_name:"Manuel"})});if(!s.ok)return this.getLocalFallback();const r=null==(i=s.body)?void 0:i.getReader();if(!r)return this.getLocalFallback();const a=new TextDecoder;let n="",o="";for(;;){const{done:e,value:s}=await r.read();if(e)break;const i=a.decode(s,{stream:!0}).split("\n");for(const r of i)if(r.startsWith("data: "))try{const e=JSON.parse(r.slice(6));"delta"===e.type?(n+=e.text,t(e.text)):"done"===e.type&&(o=e.responseId||"")}catch{}}return r.releaseLock(),{message:n,responseId:o,motivation:this.extractMotivation(n)}}catch(r){return console.error("Streaming error:",r),this.getLocalFallback()}}getLocalFallback(){const e=["Forza Manuel! Dai il massimo in questa serie!","Concentrati sulla tecnica, il peso verra dopo!","Ogni ripetizione ti avvicina al tuo obiettivo!","Respira, concentrati, esegui. Sei forte!","Non mollare! Questa e la serie che fa la differenza!","Ottimo lavoro! Continua cosi!","Ricorda: la costanza batte il talento!","Sei qui per migliorare. E lo stai facendo!"];return{message:e[Math.floor(Math.random()*e.length)],responseId:"",motivation:"Forza!"}}extractMotivation(e){const t=["Forza!","Dai tutto!","Ottimo lavoro!","Continua cosi!","Sei forte!","Non mollare!","Ancora una!","Perfetto!"];for(const s of t)if(e.toLowerCase().includes(s.toLowerCase()))return s;return"Forza!"}async onWorkoutStart(e){return await this.chat(`Sto iniziando il workout "${e}". Dammi una breve motivazione per iniziare!`)}async onExerciseStart(e,t,s,i,r){return await this.chat(`Nuovo esercizio: ${e}. ${t} serie da ${s}. Dammi un consiglio tecnico breve.`,{currentExercise:e,totalSets:t,currentSet:1,reps:parseInt(s)||10,exerciseIndex:i,totalExercises:r})}async onSetComplete(e,t,s,i,r){return await this.chat(`Ho completato la serie ${t}/${s} di ${e}: ${i}kg x ${r} reps. Commenta brevemente!`,{currentExercise:e,currentSet:t,totalSets:s,weight:i,reps:r})}async onRestStart(e,t,s){return await this.chat(`Inizio riposo di ${e} secondi. Prossima serie: ${t}/${s}. Dammi una frase breve per prepararmi.`)}async onRestEnd(){return await this.chat("Riposo finito! Dammi una frase motivazionale brevissima per la prossima serie.")}async onWorkoutComplete(e,t,s,i){return await this.chat(`Ho completato "${e}"! ${t} esercizi, ${s} serie totali in ${Math.round(i/60)} minuti. Celebra il mio risultato!`)}async onNewPersonalRecord(e,t,s){return await this.chat(`NUOVO RECORD PERSONALE! ${e}: ${t}kg x ${s} reps! Celebra questo momento!`)}async suggestWeight(e){return await this.chat(`Che peso mi consigli per ${e} oggi? Basati sul mio storico.`)}async askTechnique(e){return await this.chat(`Dammi 2-3 punti chiave sulla tecnica corretta per ${e}.`)}},le="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9iZGx1YnFxamdiZ2poY3RwaGNzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDE2OTUsImV4cCI6MjA4MDA3NzY5NX0.7pWBVjOLYZEg_7deWsTLGrJaBD7eTyhb1U31oFxlWek";const ce=new class{constructor(){t(this,"currentAudio",null),t(this,"recognition",null),t(this,"isListeningForWakeWord",!1),t(this,"isListeningForCommand",!1),t(this,"wakeWordCallback",null),t(this,"onTranscriptCallback",null),t(this,"silenceTimeout",null),t(this,"coachVoice","onyx"),t(this,"wakeWords",["ehi orion","hey orion","ei orion","ok orion","ciao orion"]),this.initSpeechRecognition()}initSpeechRecognition(){const e=window.SpeechRecognition||window.webkitSpeechRecognition;e?(this.recognition=new e,this.recognition.lang="it-IT",this.recognition.continuous=!0,this.recognition.interimResults=!0,this.recognition.onresult=e=>{let t="",s="";for(let i=e.resultIndex;i<e.results.length;i++){const r=e.results[i][0].transcript;e.results[i].isFinal?t+=r:s+=r}if(this.resetSilenceTimeout(),this.isListeningForWakeWord){const e=(t+s).toLowerCase();for(const t of this.wakeWords)if(e.includes(t))return console.log("Wake word detected:",t),this.isListeningForWakeWord=!1,void(this.wakeWordCallback&&this.wakeWordCallback())}this.isListeningForCommand&&t&&(console.log("Final transcript:",t),this.onTranscriptCallback&&this.onTranscriptCallback(t),this.stopListening())},this.recognition.onerror=e=>{if("not-allowed"===e.error||"service-not-allowed"===e.error)return console.warn("Microfono non autorizzato. Attiva i permessi."),this.isListeningForWakeWord=!1,void(this.isListeningForCommand=!1);"no-speech"===e.error?this.restartRecognition():"aborted"!==e.error&&console.error("Speech recognition error:",e.error)},this.recognition.onend=()=>{(this.isListeningForWakeWord||this.isListeningForCommand)&&this.restartRecognition()}):console.warn("Speech Recognition not supported")}restartRecognition(){if(this.recognition&&(this.isListeningForWakeWord||this.isListeningForCommand))try{this.recognition.start()}catch(e){}}resetSilenceTimeout(){this.silenceTimeout&&clearTimeout(this.silenceTimeout),this.isListeningForCommand&&(this.silenceTimeout=setTimeout(()=>{console.log("Silence detected, stopping..."),this.recognition&&this.recognition.stop()},2e3))}startWakeWordDetection(e){if(this.recognition){this.wakeWordCallback=e,this.isListeningForWakeWord=!0,this.isListeningForCommand=!1;try{this.recognition.start(),console.log("Listening for wake word...")}catch(t){}}else console.error("Speech Recognition not available")}stopWakeWordDetection(){this.isListeningForWakeWord=!1,this.wakeWordCallback=null,this.recognition&&!this.isListeningForCommand&&this.recognition.stop()}async startListening(){if(!this.recognition)throw new Error("Speech Recognition not available");this.isListeningForCommand=!0,this.isListeningForWakeWord=!1;try{this.recognition.start(),console.log("Listening for command...")}catch(e){}}listenForCommand(){return new Promise((e,t)=>{if(this.recognition){this.onTranscriptCallback=t=>{this.onTranscriptCallback=null,e(t)},this.isListeningForCommand=!0,this.isListeningForWakeWord=!1;try{this.recognition.start()}catch(s){}setTimeout(()=>{this.isListeningForCommand&&(this.stopListening(),e(""))},1e4)}else t(new Error("Speech Recognition not available"))})}stopListening(){this.isListeningForCommand=!1,this.silenceTimeout&&(clearTimeout(this.silenceTimeout),this.silenceTimeout=null),this.recognition&&this.recognition.stop(),this.wakeWordCallback&&setTimeout(()=>{this.isListeningForWakeWord=!0,this.restartRecognition()},500)}async speak(e,t){var s;const i=this.isListeningForWakeWord;i&&(null==(s=this.recognition)||s.stop()),"speechSynthesis"in window?await this.speakWithWebAPI(e):await this.speakWithOpenAI(e,t||this.coachVoice),i&&this.wakeWordCallback&&setTimeout(()=>{this.isListeningForWakeWord=!0,this.restartRecognition()},300)}speakWithWebAPI(e){return new Promise(t=>{speechSynthesis.cancel();const s=new SpeechSynthesisUtterance(e);s.lang="it-IT",s.rate=1,s.pitch=.9,s.volume=1;const i=()=>{const e=speechSynthesis.getVoices().find(e=>e.lang.startsWith("it"));e&&(s.voice=e)};speechSynthesis.getVoices().length>0?i():speechSynthesis.onvoiceschanged=i,s.onend=()=>t(),s.onerror=e=>{console.error("TTS error:",e),t()},setTimeout(()=>{speechSynthesis.speak(s)},50)})}async speakWithOpenAI(e,t){try{const s=await fetch("https://obdlubqqjgbgjhctphcs.supabase.co/functions/v1/voice-tts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${le}`,apikey:le},body:JSON.stringify({text:e,voice:t})});if(!s.ok)return this.speakWithWebAPI(e);const i=await s.blob(),r=URL.createObjectURL(i);return new Promise((e,t)=>{this.currentAudio=new Audio(r),this.currentAudio.onended=()=>{URL.revokeObjectURL(r),e()},this.currentAudio.onerror=t,this.currentAudio.play()})}catch(s){return this.speakWithWebAPI(e)}}stopSpeaking(){this.currentAudio&&(this.currentAudio.pause(),this.currentAudio=null),"speechSynthesis"in window&&speechSynthesis.cancel()}isVoiceSupported(){return{tts:"speechSynthesis"in window,stt:"SpeechRecognition"in window||"webkitSpeechRecognition"in window}}setCoachVoice(e){this.coachVoice=e}getIsRecording(){return this.isListeningForCommand}getIsListeningForWakeWord(){return this.isListeningForWakeWord}},de=()=>{const e=a(),{user:t}=T(),i=s.useRef(!1),[r,n]=s.useState(!0),[o,l]=s.useState(null),[c,d]=s.useState(null),[u,h]=s.useState(!0),[m,p]=s.useState(!1),[x,g]=s.useState(""),[f,y]=s.useState(!1),[b,v]=s.useState(new Date),[k,j]=s.useState(""),[N,S]=s.useState(!1);s.useEffect(()=>{const e=setInterval(()=>v(new Date),1e3);return()=>clearInterval(e)},[]),s.useEffect(()=>{i.current||(i.current=!0,(null==t?void 0:t.id)&&oe.setUserId(t.id),_())},[t]);const _=async()=>{n(!0);const e=setTimeout(()=>{const e=C(null);l(e),d({total:0,thisWeek:0}),g("Pronto per spaccare?"),n(!1)},5e3);try{if(!(null==t?void 0:t.id)){clearTimeout(e);const t=C(null);return l(t),d({total:0,thisWeek:0}),g("Pronto per spaccare?"),void n(!1)}const{data:s}=await I.from("workout_sessions").select("*").eq("user_id",t.id).eq("completed",!0).order("end_time",{ascending:!1}).limit(1),i=(null==s?void 0:s[0])||null;d({total:0,thisWeek:0});const r=C(i);l(r);const a=(new Date).getHours();g(`${a<12?"Buongiorno":a<18?"Buon pomeriggio":"Buonasera"} Manuel! ${r.reason}`),clearTimeout(e)}catch(s){console.error("Init error:",s),clearTimeout(e);const t=C(null);l(t),g("Pronto per spaccare?")}finally{n(!1)}},C=e=>{const t=[{id:"upper_a",name:"UPPER A",desc:"Petto & Tricipiti",exercises:9,time:60},{id:"lower_a",name:"LOWER A",desc:"Quadricipiti",exercises:9,time:55},{id:"upper_b",name:"UPPER B",desc:"Schiena & Bicipiti",exercises:9,time:60},{id:"lower_b",name:"LOWER B",desc:"Posteriori",exercises:9,time:55}];let s=0,i="Iniziamo con forza!";if(null==e?void 0:e.workout_type){s=(t.findIndex(t=>t.id===e.workout_type)+1)%t.length,i="Seguendo la rotazione"}const r=t[s];return{workoutId:r.id,workoutName:`${r.name} - ${r.desc}`,reason:i,exercises:r.exercises,estimatedTime:r.time}},W=async()=>{if(!k.trim()||N)return;const e=k.trim();j(""),S(!0),g("...");try{const t=await oe.chat(e);g(t.message),u&&(y(!0),await ce.speak(t.message),y(!1))}catch(t){console.error("Chat error:",t),g("Errore di connessione")}finally{S(!1)}};return r?w.jsx("div",{className:"fixed inset-0 bg-black flex items-center justify-center",children:w.jsxs("div",{className:"text-center",children:[w.jsxs("div",{className:"relative w-32 h-32 mx-auto mb-8",children:[w.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-purple-500/30 animate-ping"}),w.jsx("div",{className:"absolute inset-2 rounded-full border-2 border-purple-500/50 animate-pulse"}),w.jsx("div",{className:"absolute inset-4 rounded-full bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center",children:w.jsx(A,{className:"w-12 h-12 text-white"})})]}),w.jsx("h1",{className:"text-2xl font-black text-white tracking-wider",children:"LINKINFIT"}),w.jsx("p",{className:"text-purple-400 mt-2 text-sm tracking-widest uppercase",children:"Initializing..."})]})}):w.jsxs("div",{className:"fixed inset-0 bg-black overflow-hidden flex flex-col",children:[w.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[w.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-purple-600/20 rounded-full blur-[128px]"}),w.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-pink-600/20 rounded-full blur-[128px]"}),w.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,transparent_0%,black_70%)]"})]}),w.jsxs("header",{className:"relative z-10 px-6 pt-12 pb-4 flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-4",children:[w.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center "+(f?"animate-pulse shadow-lg shadow-purple-500/50":""),children:w.jsx(K,{className:"w-6 h-6 text-white"})}),w.jsxs("div",{children:[w.jsx("h1",{className:"text-white font-bold text-lg",children:"COACH ORION"}),w.jsx("p",{className:"text-gray-500 text-xs uppercase tracking-wider",children:f?"Speaking...":"AI Personal Trainer"})]})]}),w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsxs("div",{className:"text-right mr-4",children:[w.jsx("div",{className:"text-3xl font-mono text-white font-light",children:b.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})}),w.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wider",children:b.toLocaleDateString("it-IT",{weekday:"long"})})]}),w.jsx("button",{onClick:()=>h(!u),className:"w-12 h-12 rounded-2xl flex items-center justify-center transition-all "+(u?"bg-purple-500/20 text-purple-400":"bg-white/5 text-gray-600"),children:u?w.jsx(te,{className:"w-5 h-5"}):w.jsx(se,{className:"w-5 h-5"})})]})]}),w.jsxs("main",{className:"relative z-10 flex-1 flex flex-col items-center justify-center px-6 pb-32",children:[c&&w.jsxs("div",{className:"flex gap-8 mb-12",children:[w.jsxs("div",{className:"text-center",children:[w.jsx("div",{className:"w-20 h-20 rounded-3xl bg-gradient-to-br from-orange-500/20 to-red-500/20 border border-orange-500/30 flex items-center justify-center mb-3",children:w.jsx(D,{className:"w-8 h-8 text-orange-400"})}),w.jsx("div",{className:"text-4xl font-black text-white",children:c.thisWeek}),w.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wider mt-1",children:"This Week"})]}),w.jsxs("div",{className:"text-center",children:[w.jsx("div",{className:"w-20 h-20 rounded-3xl bg-gradient-to-br from-green-500/20 to-emerald-500/20 border border-green-500/30 flex items-center justify-center mb-3",children:w.jsx(Q,{className:"w-8 h-8 text-green-400"})}),w.jsx("div",{className:"text-4xl font-black text-white",children:c.total}),w.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wider mt-1",children:"Total"})]}),w.jsxs("div",{className:"text-center",children:[w.jsx("div",{className:"w-20 h-20 rounded-3xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 border border-purple-500/30 flex items-center justify-center mb-3",children:w.jsx(re,{className:"w-8 h-8 text-purple-400"})}),w.jsx("div",{className:"text-4xl font-black text-white",children:"4"}),w.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wider mt-1",children:"Goal"})]})]}),w.jsx("div",{className:"text-center mb-12 max-w-xl",children:w.jsxs("p",{className:"text-2xl md:text-3xl text-white font-light leading-relaxed",children:['"',x,'"']})}),o&&w.jsxs("button",{onClick:()=>{o&&e("/workout")},className:"group relative w-full max-w-sm mx-auto px-4",children:[w.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl blur-xl opacity-40 group-hover:opacity-60 transition-opacity"}),w.jsxs("div",{className:"relative bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl p-4 transform group-hover:scale-[1.02] transition-transform overflow-hidden",children:[w.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[w.jsx(R,{className:"w-3.5 h-3.5 text-white/70"}),w.jsx("span",{className:"text-white/70 text-[10px] font-semibold uppercase tracking-widest",children:"Next Workout"})]}),w.jsxs("div",{className:"flex items-center",children:[w.jsxs("div",{className:"flex-1 min-w-0 pr-3",children:[w.jsx("h2",{className:"text-xl font-bold text-white mb-1",children:o.workoutName.split(" - ")[0]}),w.jsx("p",{className:"text-white/70 text-sm mb-2",children:o.workoutName.split(" - ")[1]}),w.jsxs("div",{className:"flex items-center gap-3 text-white/60 text-xs",children:[w.jsxs("span",{className:"flex items-center gap-1",children:[w.jsx(A,{className:"w-3 h-3"}),o.exercises]}),w.jsxs("span",{className:"flex items-center gap-1",children:[w.jsx(M,{className:"w-3 h-3"}),o.estimatedTime,"m"]})]})]}),w.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-full flex items-center justify-center group-hover:bg-white/30 transition-colors flex-shrink-0",children:w.jsx(Y,{className:"w-7 h-7 text-white fill-white ml-0.5"})})]})]})]})]}),w.jsx("footer",{className:"absolute bottom-0 left-0 right-0 z-10 pb-6 pt-12 bg-gradient-to-t from-black via-black/90 to-transparent",children:w.jsxs("div",{className:"flex flex-col items-center px-4",children:[w.jsxs("div",{className:"w-full max-w-sm flex items-center gap-2",children:[w.jsxs("button",{onClick:async()=>{if(m)ce.stopListening(),p(!1);else{p(!0);try{const e=await ce.listenForCommand();if(p(!1),e){g("Elaboro...");const t=await oe.chat(e);g(t.message),u&&(y(!0),await ce.speak(t.message),y(!1))}}catch(e){console.error("Voice error:",e),p(!1)}}},className:"relative w-10 h-10 rounded-full flex items-center justify-center transition-all flex-shrink-0 "+(m?"bg-red-500 shadow-lg shadow-red-500/50":"bg-white/10 hover:bg-white/20"),children:[m&&w.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-red-400 animate-ping"}),w.jsx(V,{className:"w-4 h-4 "+(m?"text-white":"text-gray-400")})]}),w.jsx("input",{type:"text",value:k,onChange:e=>j(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),W())},placeholder:"Scrivi al Coach...",disabled:N,className:"flex-1 min-w-0 bg-white/10 text-white placeholder-gray-500 rounded-full px-4 py-2.5 text-sm border border-white/10 focus:outline-none focus:border-purple-500/50 focus:bg-white/15 transition-all disabled:opacity-50"}),w.jsx("button",{onClick:W,disabled:!k.trim()||N,className:"w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center flex-shrink-0 disabled:opacity-30 disabled:cursor-not-allowed hover:from-purple-400 hover:to-pink-400 transition-all",children:w.jsx(H,{className:"w-4 h-4 text-white"})})]}),w.jsx("p",{className:"text-gray-500 text-xs mt-3 uppercase tracking-wider",children:m?"Ascoltando...":N?"Elaborando...":"Voce o testo"})]})})]})};const ue=new class{constructor(){t(this,"userId",null)}setUserId(e){this.userId=e}async getCurrentUser(){const{data:{user:e}}=await I.auth.getUser();return e&&(this.userId=e.id),e}async startWorkoutSession(e,t){if(this.userId||await this.getCurrentUser(),!this.userId)return null;const{data:s,error:i}=await I.from("workout_sessions").insert({user_id:this.userId,workout_type:e,workout_name:t,start_time:(new Date).toISOString(),completed:!1}).select().single();return i?(console.error("Errore creazione sessione:",i),null):s}async completeWorkoutSession(e,t,s){const{error:i}=await I.from("workout_sessions").update({end_time:(new Date).toISOString(),completed:!0,total_exercises:t,total_sets:s}).eq("id",e);return!i||(console.error("Errore completamento sessione:",i),!1)}async getRecentSessions(e=10){if(this.userId||await this.getCurrentUser(),!this.userId)return[];const{data:t,error:s}=await I.from("workout_sessions").select("*").eq("user_id",this.userId).order("start_time",{ascending:!1}).limit(e);return s?(console.error("Errore recupero sessioni:",s),[]):t||[]}async saveSet(e,t,s,i,r,a,n){if(this.userId||await this.getCurrentUser(),!this.userId)return null;const{data:o,error:l}=await I.from("workout_sets").insert({session_id:e,user_id:this.userId,exercise_name:t,set_number:s,weight:i,reps:r,target_reps:a,rest_time:n,completed_at:(new Date).toISOString()}).select().single();return l?(console.error("Errore salvataggio set:",l),null):(i&&await this.updatePersonalRecord(t,i,r),o)}async updatePersonalRecord(e,t,s){if(!this.userId)return;const i=t*(36/(37-s)),{data:r}=await I.from("personal_records").select("*").eq("user_id",this.userId).eq("exercise_name",e).single();if(r){const e={};(!r.max_weight||t>r.max_weight)&&(e.max_weight=t),(!r.max_reps||s>r.max_reps)&&(e.max_reps=s),(!r.one_rm||i>r.one_rm)&&(e.one_rm=i,e.achieved_at=(new Date).toISOString()),Object.keys(e).length>0&&await I.from("personal_records").update(e).eq("id",r.id)}else await I.from("personal_records").insert({user_id:this.userId,exercise_name:e,max_weight:t,max_reps:s,one_rm:i})}async getExerciseHistory(e){if(this.userId||await this.getCurrentUser(),!this.userId)return null;const{data:t}=await I.from("workout_sets").select("*").eq("user_id",this.userId).eq("exercise_name",e).order("completed_at",{ascending:!1}).limit(1).single(),{data:s}=await I.from("personal_records").select("*").eq("user_id",this.userId).eq("exercise_name",e).single(),{count:i}=await I.from("workout_sets").select("*",{count:"exact",head:!0}).eq("user_id",this.userId).eq("exercise_name",e);return t?{exercise_name:e,last_weight:t.weight||0,last_reps:t.reps,last_date:t.completed_at,best_weight:(null==s?void 0:s.max_weight)||t.weight||0,best_reps:(null==s?void 0:s.max_reps)||t.reps,total_sessions:i||0}:null}async getStats(){if(this.userId||await this.getCurrentUser(),!this.userId)return{totalWorkouts:0,thisWeek:0,thisMonth:0,lastWorkout:null};const e=new Date,t=new Date(e.getTime()-6048e5),s=new Date(e.getTime()-2592e6),{count:i}=await I.from("workout_sessions").select("*",{count:"exact",head:!0}).eq("user_id",this.userId).eq("completed",!0),{count:r}=await I.from("workout_sessions").select("*",{count:"exact",head:!0}).eq("user_id",this.userId).eq("completed",!0).gte("start_time",t.toISOString()),{count:a}=await I.from("workout_sessions").select("*",{count:"exact",head:!0}).eq("user_id",this.userId).eq("completed",!0).gte("start_time",s.toISOString()),{data:n}=await I.from("workout_sessions").select("*").eq("user_id",this.userId).eq("completed",!0).order("end_time",{ascending:!1}).limit(1).single();return{totalWorkouts:i||0,thisWeek:r||0,thisMonth:a||0,lastWorkout:n||null}}getSuggestedWeight(e){if(!e)return 0;const{last_weight:t,last_reps:s}=e;return s>=10?Math.round(2*(t+2.5))/2:s>=8?t:Math.max(0,Math.round(2*(t-1.25))/2)}async logSupplement(e,t,s){if(this.userId||await this.getCurrentUser(),!this.userId)return!1;const{error:i}=await I.from("supplement_logs").insert({user_id:this.userId,supplement_name:e,timing:t,notes:s});return!i}async getSupplementHistory(e=7){if(this.userId||await this.getCurrentUser(),!this.userId)return[];const t=new Date;t.setDate(t.getDate()-e);const{data:s}=await I.from("supplement_logs").select("*").eq("user_id",this.userId).gte("taken_at",t.toISOString()).order("taken_at",{ascending:!1});return s||[]}},he=()=>{const e=a(),{state:t,actions:i}=_(),{user:r}=T(),[n,o]=s.useState(0),[l,c]=s.useState(!1),[d,u]=s.useState(!1),[h,m]=s.useState(null),[p,x]=s.useState(""),[g,f]=s.useState(""),[y,b]=s.useState("Forza! Dai il massimo!"),[v,k]=s.useState(!0),[j]=s.useState(Date.now()),[N,S]=s.useState(!1),[I,C]=s.useState(""),[W,E]=s.useState(!1),[L,R]=s.useState(""),[O,M]=s.useState(!1),A=s.useCallback(e=>{if(!v)return;const t=new(window.AudioContext||window.webkitAudioContext),s=t.createOscillator(),i=t.createGain();s.connect(i),i.connect(t.destination),s.frequency.value="complete"===e?800:600,i.gain.value=.3,s.start(),s.stop(t.currentTime+.15)},[v]),P=s.useCallback(async e=>{if(v)try{await ce.speak(e)}catch(t){console.error("TTS error:",t)}},[v]);s.useEffect(()=>{let e=null;const t=async()=>{try{"wakeLock"in navigator&&(e=await navigator.wakeLock.request("screen"),console.log("Wake Lock attivo - schermo sempre acceso"))}catch(t){console.log("Wake Lock non disponibile:",t)}};t();const s=()=>{"visible"===document.visibilityState&&t()};return document.addEventListener("visibilitychange",s),()=>{e&&e.release(),document.removeEventListener("visibilitychange",s)}},[]),s.useEffect(()=>{t.currentSession||i.startWorkout("upper_a");(async()=>{if((null==r?void 0:r.id)&&!h){const e=t.workouts.find(e=>"upper_a"===e.id);if(e){const t=await ue.startWorkoutSession("upper_a",e.name);t&&m(t.id)}}})()},[null==r?void 0:r.id]),s.useEffect(()=>(W&&v?(ce.startWakeWordDetection(()=>{console.log("Wake word detected!"),A("beep"),C("Ti ascolto..."),q()}),C('DÃ¬ "Ehi Orion"...')):(ce.stopWakeWordDetection(),N||C("")),()=>{ce.stopWakeWordDetection()}),[W,v]),s.useEffect(()=>{if(!l||d)return;const e=setInterval(()=>{o(e=>e<=1?(A("complete"),P("Riposo finito! Vai con la prossima serie!"),c(!1),0):(4===e&&A("beep"),10===e&&P("10 secondi"),e-1))},1e3);return()=>clearInterval(e)},[l,d,A,P]);const D=async s=>{var i;const r=s.toLowerCase();console.log("Voice command:",r);const a=r.match(/\d+/g);if((r.includes("peso")||r.includes("chili")||r.includes("kg"))&&a&&a.length>0)return x(a[0]),C(`Peso: ${a[0]} kg`),void P(`${a[0]} chili`);if((r.includes("ripetizioni")||r.includes("reps")||r.includes("rep"))&&a&&a.length>0)return f(a[0]),C(`Ripetizioni: ${a[0]}`),void P(`${a[0]} ripetizioni`);if(a&&a.length>0&&!p)return x(a[0]),C(`Peso: ${a[0]} kg`),void P(`${a[0]} chili. Ora dimmi le ripetizioni.`);if(a&&a.length>0&&p&&!g)return f(a[0]),C(`Ripetizioni: ${a[0]}`),void P(`${a[0]} ripetizioni. DÃ¬ fatto per completare.`);if(r.includes("fatto")||r.includes("completa")||r.includes("finito")||r.includes("ok"))return p&&g?void Z():void P("Prima dimmi peso e ripetizioni");if(r.includes("salta")||r.includes("prossimo")||r.includes("avanti"))return void(l?(c(!1),o(0),P("Riposo saltato")):(K(),P("Esercizio saltato")));if(r.includes("pausa")||r.includes("stop")||r.includes("ferma"))return u(!0),void P("Pausa");if(r.includes("riprendi")||r.includes("vai")||r.includes("continua"))return u(!1),void P("Riprendo");if(r.includes("termina")||r.includes("esci")||r.includes("fine"))return P("Allenamento terminato"),void e("/");const n=await oe.chat(s,{currentExercise:null==J?void 0:J.name,currentSet:null==(i=t.currentSession)?void 0:i.current_set,totalSets:null==J?void 0:J.sets});b(n.message),P(n.message)},q=async()=>{S(!0),C("Parla...");try{const e=await ce.listenForCommand();S(!1),e&&(C("Elaboro..."),await D(e)),C("")}catch(e){console.error("Voice error:",e),S(!1),C("")}},$=async()=>{if(!L.trim()||O)return;const e=L.trim();R(""),M(!0),await D(e),M(!1)};if(!t.currentSession||0===t.workouts.length)return w.jsx("div",{className:"fixed inset-0 bg-black flex items-center justify-center",children:w.jsx("div",{className:"w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full animate-spin"})});const U=t.workouts.find(e=>{var s;return e.id===(null==(s=t.currentSession)?void 0:s.workout_id)});if(!U)return null;const J=U.exercises[t.currentSession.current_exercise_index],B=t.currentSession.current_exercise_index/U.exercises.length*100,Z=async()=>{if(!p||!g)return;A("complete");const e=parseFloat(p),s=parseInt(g);h&&(null==r?void 0:r.id)&&await ue.saveSet(h,J.name,t.currentSession.current_set,e,s);const a=await oe.onSetComplete(J.name,t.currentSession.current_set,J.sets,e,s);b(a.message),P(a.message),t.currentSession.current_set<J.sets?(o(J.rest_time),c(!0),i.updateSession({current_set:t.currentSession.current_set+1})):K(),x(""),f("")},K=()=>{if(c(!1),o(0),t.currentSession.current_exercise_index<U.exercises.length-1){i.updateSession({current_exercise_index:t.currentSession.current_exercise_index+1,current_set:1});const e=U.exercises[t.currentSession.current_exercise_index+1];setTimeout(()=>P(`Prossimo esercizio: ${e.name}`),500)}else P("Complimenti! Allenamento completato!"),setTimeout(()=>e("/"),2e3)},Q=e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`,ee=Math.floor((Date.now()-j)/1e3);return w.jsxs("div",{className:"fixed inset-0 bg-black overflow-hidden flex flex-col",children:[w.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[w.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-purple-600/10 rounded-full blur-[128px]"}),w.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-pink-600/10 rounded-full blur-[128px]"})]}),w.jsxs("header",{className:"relative z-10 px-4 py-3 flex items-center justify-between border-b border-white/5",children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("button",{onClick:()=>e("/"),className:"w-10 h-10 rounded-full bg-white/5 flex items-center justify-center hover:bg-white/10",children:w.jsx(F,{className:"w-5 h-5 text-gray-400"})}),w.jsxs("div",{children:[w.jsx("h1",{className:"text-white font-bold text-sm",children:U.name.split(" - ")[0]}),w.jsxs("p",{className:"text-gray-500 text-xs",children:[t.currentSession.current_exercise_index+1,"/",U.exercises.length]})]})]}),w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:"text-right",children:w.jsx("div",{className:"text-xl font-mono text-white",children:Q(ee)})}),w.jsx("button",{onClick:()=>k(!v),className:"w-10 h-10 rounded-full bg-white/5 flex items-center justify-center",children:v?w.jsx(te,{className:"w-5 h-5 text-purple-400"}):w.jsx(se,{className:"w-5 h-5 text-gray-600"})})]})]}),w.jsx("div",{className:"h-1 bg-white/5",children:w.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all",style:{width:`${B}%`}})}),w.jsx("main",{className:"relative z-10 flex-1 flex flex-col items-center justify-center px-4 py-6",children:l?w.jsxs("div",{className:"text-center",children:[w.jsx("p",{className:"text-gray-500 text-xs uppercase tracking-widest mb-2",children:"Riposo"}),w.jsx("div",{className:"text-[6rem] md:text-[10rem] font-mono font-bold text-white leading-none",children:Q(n)}),w.jsx("p",{className:"text-gray-400 mt-2 text-sm",children:n<=5?"Preparati!":"Recupera"}),w.jsxs("div",{className:"flex gap-3 mt-6 justify-center",children:[w.jsxs("button",{onClick:()=>u(!d),className:"px-5 py-2 rounded-full bg-white/10 text-white text-sm flex items-center gap-2",children:[d?w.jsx(Y,{className:"w-4 h-4"}):w.jsx(G,{className:"w-4 h-4"}),d?"Riprendi":"Pausa"]}),w.jsxs("button",{onClick:()=>{c(!1),o(0)},className:"px-5 py-2 rounded-full bg-purple-600 text-white text-sm flex items-center gap-2",children:[w.jsx(X,{className:"w-4 h-4"}),"Salta"]})]})]}):w.jsxs("div",{className:"w-full max-w-sm text-center",children:[w.jsxs("div",{className:"mb-6",children:[w.jsx("p",{className:"text-gray-500 text-[10px] uppercase tracking-widest mb-1",children:"Esercizio"}),w.jsx("h2",{className:"text-xl md:text-2xl font-bold text-white mb-1",children:J.name}),w.jsxs("p",{className:"text-purple-400",children:["Serie ",t.currentSession.current_set,"/",J.sets]})]}),w.jsxs("div",{className:"flex justify-center gap-4 mb-6 text-xs",children:[w.jsxs("div",{className:"px-3 py-1.5 bg-white/5 rounded-full",children:[w.jsx("span",{className:"text-gray-500",children:"Target:"}),w.jsx("span",{className:"text-white ml-1",children:J.target_reps})]}),w.jsxs("div",{className:"px-3 py-1.5 bg-white/5 rounded-full",children:[w.jsx("span",{className:"text-gray-500",children:"Riposo:"}),w.jsxs("span",{className:"text-white ml-1",children:[J.rest_time,"s"]})]})]}),w.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[w.jsxs("div",{children:[w.jsx("label",{className:"text-gray-500 text-[10px] uppercase tracking-wider block mb-1",children:"Peso (kg)"}),w.jsx("input",{type:"number",value:p,onChange:e=>x(e.target.value),placeholder:"0",className:"w-full bg-white/5 border border-white/10 rounded-xl px-3 py-3 text-2xl text-center text-white font-bold focus:outline-none focus:border-purple-500"})]}),w.jsxs("div",{children:[w.jsx("label",{className:"text-gray-500 text-[10px] uppercase tracking-wider block mb-1",children:"Reps"}),w.jsx("input",{type:"number",value:g,onChange:e=>f(e.target.value),placeholder:"0",className:"w-full bg-white/5 border border-white/10 rounded-xl px-3 py-3 text-2xl text-center text-white font-bold focus:outline-none focus:border-purple-500"})]})]}),w.jsxs("button",{onClick:Z,disabled:!p||!g,className:"w-full py-3 rounded-xl bg-gradient-to-r from-green-500 to-emerald-500 text-white font-bold flex items-center justify-center gap-2 disabled:opacity-30 disabled:cursor-not-allowed",children:[w.jsx(z,{className:"w-5 h-5"}),"Completa Serie"]}),w.jsx("div",{className:"mt-4 p-3 bg-white/5 rounded-xl border border-white/5",children:w.jsx("p",{className:"text-gray-300 text-sm",children:y})})]})}),w.jsxs("div",{className:"relative z-10 flex items-center justify-center gap-6 pb-4",children:[w.jsxs("button",{onClick:()=>E(!W),className:"flex flex-col items-center transition-all "+(W?"opacity-100":"opacity-50"),children:[w.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center "+(W?"bg-green-500 shadow-lg shadow-green-500/50":"bg-white/10"),children:w.jsx("span",{className:"text-lg",children:"ðŸŽ¤"})}),w.jsx("p",{className:"text-gray-500 text-[10px] mt-1 uppercase",children:W?"Ehi Orion ON":"Ehi Orion"})]}),w.jsx("button",{onClick:async()=>{N?(ce.stopListening(),S(!1),C("")):q()},className:"w-16 h-16 rounded-full flex items-center justify-center transition-all "+(N?"bg-red-500 shadow-lg shadow-red-500/50 animate-pulse":"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-400 hover:to-pink-400"),children:w.jsx(V,{className:"w-7 h-7 text-white"})}),w.jsx("div",{className:"w-12"})]}),I&&w.jsx("p",{className:"text-center text-purple-400 text-xs pb-2 animate-pulse",children:I}),w.jsx("div",{className:"relative z-10 w-full flex justify-center px-6 pb-3",children:w.jsxs("div",{className:"flex items-center gap-2 w-full max-w-md",children:[w.jsx("input",{type:"text",value:L,onChange:e=>R(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),$())},placeholder:"Scrivi a Orion...",disabled:O,className:"flex-1 bg-white/5 border border-white/10 rounded-full px-4 py-2.5 text-white text-sm placeholder-gray-500 focus:outline-none focus:border-purple-500 disabled:opacity-50"}),w.jsx("button",{onClick:$,disabled:!L.trim()||O,className:"w-10 h-10 rounded-full bg-purple-500 flex items-center justify-center flex-shrink-0 disabled:opacity-30 disabled:cursor-not-allowed hover:bg-purple-400 transition-colors",children:w.jsx(H,{className:"w-4 h-4 text-white"})})]})}),w.jsxs("footer",{className:"relative z-10 px-4 py-3 border-t border-white/5",children:[w.jsxs("div",{className:"flex justify-center gap-3 flex-wrap",children:[w.jsx("button",{onClick:()=>{x("20"),P("20 chili")},className:"px-3 py-1.5 rounded-full bg-white/5 text-gray-400 text-xs hover:bg-white/10",children:"20kg"}),w.jsx("button",{onClick:()=>{x("25"),P("25 chili")},className:"px-3 py-1.5 rounded-full bg-white/5 text-gray-400 text-xs hover:bg-white/10",children:"25kg"}),w.jsx("button",{onClick:()=>{x("30"),P("30 chili")},className:"px-3 py-1.5 rounded-full bg-white/5 text-gray-400 text-xs hover:bg-white/10",children:"30kg"}),w.jsx("button",{onClick:()=>{f("8"),P("8 ripetizioni")},className:"px-3 py-1.5 rounded-full bg-white/5 text-gray-400 text-xs hover:bg-white/10",children:"8 reps"}),w.jsx("button",{onClick:()=>{f("10"),P("10 ripetizioni")},className:"px-3 py-1.5 rounded-full bg-white/5 text-gray-400 text-xs hover:bg-white/10",children:"10 reps"}),w.jsx("button",{onClick:()=>{f("12"),P("12 ripetizioni")},className:"px-3 py-1.5 rounded-full bg-white/5 text-gray-400 text-xs hover:bg-white/10",children:"12 reps"})]}),w.jsxs("div",{className:"flex justify-center gap-3 mt-2",children:[w.jsxs("button",{onClick:()=>e("/"),className:"px-3 py-1.5 rounded-full bg-white/5 text-gray-500 text-xs flex items-center gap-1 hover:bg-white/10",children:[w.jsx(ie,{className:"w-3 h-3"}),"Termina"]}),w.jsxs("button",{onClick:K,className:"px-3 py-1.5 rounded-full bg-white/5 text-gray-500 text-xs flex items-center gap-1 hover:bg-white/10",children:[w.jsx(X,{className:"w-3 h-3"}),"Salta"]})]})]})]})},me=(e="impact",t)=>{if("vibrate"in navigator)switch(e){case"impact":"heavy"===t?navigator.vibrate(50):"medium"===t?navigator.vibrate(30):navigator.vibrate(10);break;case"notification":"success"===t?navigator.vibrate([10,50,10]):"error"===t?navigator.vibrate([50,50,50]):navigator.vibrate([20,30,20]);break;case"selection":navigator.vibrate(5)}},pe=()=>{var e,t,s,i,r,a,n,o,l,c,d;const{state:u}=_(),h=[{title:"Profilo",items:[{icon:ee,label:"Informazioni Personali",value:`${null==(e=u.user)?void 0:e.first_name} ${(null==(t=u.user)?void 0:t.last_name)||""}`.trim(),action:()=>me("selection")},{icon:A,label:"Obiettivi Fitness",value:"Aumento massa muscolare",action:()=>me("selection")}]},{title:"Allenamento",items:[{icon:O,label:"Promemoria",value:"Attivi",action:()=>me("selection")},{icon:A,label:"Piano Settimanale",value:"Upper/Lower Split",action:()=>me("selection")}]},{title:"Interfaccia",items:[{icon:Z,label:"Tema",value:"Telegram Auto",action:()=>me("selection")}]},{title:"Altro",items:[{icon:q,label:"Informazioni App",value:"v1.0.0",action:()=>me("selection")},{icon:J,label:"Chiudi App",value:"",action:()=>{me("impact","medium"),close()}}]}];return w.jsxs("div",{className:"p-4 space-y-6",children:[w.jsxs("div",{className:"text-center py-4",children:[w.jsx("div",{className:"text-4xl mb-2",children:"âš™ï¸"}),w.jsx("h1",{className:"text-2xl font-bold tg-text mb-2",children:"Impostazioni"}),w.jsx("p",{className:"tg-hint",children:"Personalizza la tua esperienza"})]}),w.jsxs("div",{className:"card text-center",children:[w.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-3",children:w.jsx("span",{className:"text-2xl text-white",children:(null==(i=null==(s=u.user)?void 0:s.first_name)?void 0:i.charAt(0))||"M"})}),w.jsxs("h3",{className:"font-semibold tg-text",children:[null==(r=u.user)?void 0:r.first_name," ",(null==(a=u.user)?void 0:a.last_name)||""]}),w.jsxs("p",{className:"text-sm tg-hint",children:["@",(null==(n=u.user)?void 0:n.username)||"username"]}),w.jsxs("div",{className:"mt-3 text-xs tg-hint",children:["ID: ",null==(o=u.user)?void 0:o.id]})]}),h.map((e,t)=>w.jsxs("div",{className:"space-y-3",children:[w.jsx("h3",{className:"font-semibold tg-text text-sm uppercase tracking-wide",children:e.title}),w.jsx("div",{className:"card space-y-0 p-0 overflow-hidden",children:e.items.map((t,s)=>w.jsxs("button",{onClick:t.action,className:"w-full flex items-center justify-between p-4 text-left transition-colors hover:tg-secondary-bg haptic-light "+(s<e.items.length-1?"border-b border-gray-100":""),children:[w.jsxs("div",{className:"flex items-center space-x-3",children:[w.jsx("div",{className:"w-8 h-8 tg-secondary-bg rounded-lg flex items-center justify-center",children:w.jsx(t.icon,{className:"w-4 h-4 tg-text"})}),w.jsx("span",{className:"font-medium tg-text",children:t.label})]}),t.value&&w.jsx("span",{className:"text-sm tg-hint",children:t.value})]},s))})]},t)),w.jsxs("div",{className:"card",children:[w.jsx("h3",{className:"font-semibold tg-text mb-3",children:"Riepilogo AttivitÃ "}),w.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[w.jsxs("div",{children:[w.jsx("div",{className:"text-xl font-bold tg-link",children:(null==(l=u.statistics)?void 0:l.total_workouts)||0}),w.jsx("div",{className:"text-xs tg-hint",children:"Workout"})]}),w.jsxs("div",{children:[w.jsx("div",{className:"text-xl font-bold tg-link",children:(null==(c=u.statistics)?void 0:c.current_streak)||0}),w.jsx("div",{className:"text-xs tg-hint",children:"Streak"})]}),w.jsxs("div",{children:[w.jsx("div",{className:"text-xl font-bold tg-link",children:(null==(d=u.statistics)?void 0:d.total_exercises)||0}),w.jsx("div",{className:"text-xs tg-hint",children:"Esercizi"})]})]})]}),w.jsxs("div",{className:"text-center text-xs tg-hint space-y-1",children:[w.jsx("div",{children:"Phoenix Workout Mini App"}),w.jsx("div",{children:"Versione 1.0.0"}),w.jsx("div",{children:"Sviluppato per Manuel"})]})]})};function xe(){const{signIn:e,signUp:t}=T(),[i,r]=s.useState(""),[a,n]=s.useState(""),[o,l]=s.useState(!1),[c,d]=s.useState(""),[u,h]=s.useState("login"),[m]=s.useState(()=>void 0!==window.PublicKeyCredential);return w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 flex items-center justify-center p-4",children:w.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-lg rounded-2xl p-8 max-w-md w-full",children:[w.jsxs("div",{className:"text-center mb-8",children:[w.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-purple-500/30",children:w.jsx(A,{className:"w-10 h-10 text-white"})}),w.jsx("h1",{className:"text-3xl font-bold text-white",children:"LinkinFit"}),w.jsx("p",{className:"text-gray-400 mt-2",children:"Il tuo personal trainer digitale"})]}),w.jsxs("form",{onSubmit:async s=>{s.preventDefault(),l(!0),d("");try{if("login"===u){const{error:t}=await e(i,a);if(t)throw t}else{const{error:e}=await t(i,a);if(e)throw e}}catch(r){d(r instanceof Error?r.message:"Errore durante l'accesso")}finally{l(!1)}},className:"space-y-4",children:[w.jsxs("div",{children:[w.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email"}),w.jsxs("div",{className:"relative",children:[w.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),w.jsx("input",{type:"email",value:i,onChange:e=>r(e.target.value),placeholder:"la.tua@email.com",className:"w-full bg-gray-700/50 border border-gray-600 rounded-xl py-3 pl-11 pr-4 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500",required:!0})]})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),w.jsxs("div",{className:"relative",children:[w.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),w.jsx("input",{type:"password",value:a,onChange:e=>n(e.target.value),placeholder:"La tua password",className:"w-full bg-gray-700/50 border border-gray-600 rounded-xl py-3 pl-11 pr-4 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500",required:!0,autoComplete:"current-password"})]})]}),c&&w.jsx("div",{className:"bg-red-500/10 border border-red-500/50 rounded-xl p-3 text-red-400 text-sm",children:c}),w.jsx("button",{type:"submit",disabled:o,className:"w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold py-3 rounded-xl hover:from-purple-600 hover:to-pink-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:o?w.jsxs(w.Fragment,{children:[w.jsx($,{className:"w-5 h-5 animate-spin"}),"Caricamento..."]}):"login"===u?"Accedi":"Registrati"})]}),m&&w.jsxs("button",{onClick:async()=>{d("Face ID / Touch ID sara disponibile presto!")},className:"w-full mt-4 py-3 border border-gray-600 rounded-xl text-gray-300 hover:bg-gray-700/50 transition-colors flex items-center justify-center gap-2",children:[w.jsx(P,{className:"w-5 h-5"}),"Accedi con Face ID / Touch ID"]}),w.jsx("div",{className:"mt-6 text-center",children:w.jsx("button",{onClick:()=>h("login"===u?"register":"login"),className:"text-gray-400 hover:text-white text-sm",children:"login"===u?"Non hai un account? Registrati":"Hai gia un account? Accedi"})})]})})}function ge(){const[e,t]=s.useState(!0),[i,r]=s.useState(null),{user:a,loading:c}=T();return s.useEffect(()=>{c||(async()=>{var e,s;try{a&&r({id:1019529575,first_name:(null==(e=a.email)?void 0:e.split("@")[0])||"Manuel",last_name:"",username:(null==(s=a.email)?void 0:s.split("@")[0])||"manuel",language_code:"it"}),await new Promise(e=>setTimeout(e,500))}catch(i){console.error("Error initializing app:",i)}finally{t(!1)}})()},[a,c]),e||c?w.jsx("div",{className:"fixed inset-0 bg-black flex items-center justify-center",children:w.jsx("div",{className:"w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full animate-spin"})}):a?w.jsx(S,{user:i||{id:0,first_name:"Guest"},children:w.jsx(n,{children:w.jsxs(o,{children:[w.jsx(l,{path:"/",element:w.jsx(de,{})}),w.jsx(l,{path:"/workout",element:w.jsx(he,{})}),w.jsx(l,{path:"/settings",element:w.jsx(pe,{})}),w.jsx(l,{path:"*",element:w.jsx(de,{})})]})})}):w.jsx(xe,{})}function fe(){return w.jsx(W,{children:w.jsx(ge,{})})}b.createRoot(document.getElementById("root")).render(w.jsx(r.StrictMode,{children:w.jsx(fe,{})}));
